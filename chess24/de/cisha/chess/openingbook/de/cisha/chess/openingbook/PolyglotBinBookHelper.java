/*
 * Decompiled with CFR 0_134.
 */
package de.cisha.chess.openingbook;

import de.cisha.chess.model.FEN;
import de.cisha.chess.model.Piece;
import de.cisha.chess.model.PieceInformation;
import de.cisha.chess.model.Square;
import de.cisha.chess.model.position.Position;
import java.io.Serializable;
import java.util.Iterator;
import java.util.List;

public class PolyglotBinBookHelper {
    public static final long[] randoms = new long[]{-7117617611634414271L, 3096006490854172103L, 4961560858198160711L, -7199576581966697758L, 8467686926187236489L, 3643601464190828991L, 1133690081497064057L, -1712897760329768758L, 972344712846728208L, 1875810966947487789L, -7636462362570079312L, -3449195065476763947L, 4665150172008230450L, 77499164859392917L, 6752165915987794405L, 2566923340161161676L, 419294011261754017L, 7466832458773678449L, 8379435287740149003L, 9012210492721573360L, -9023119502491076660L, -927302695338870676L, 3680699783482293222L, 5454859592240567363L, -6168633590159683332L, -8233256716529052661L, -8659851112597712361L, 1870057424550439649L, -5428191116858910017L, 8864492181390654148L, -3943696798190020515L, 2642043227856860416L, 5521189128215049287L, 1488034881489406017L, -6405355056885088877L, 236592455471957263L, 7168370738516443200L, 707553987122498196L, 3852097769995099451L, 8313129892476901923L, 1761594034649645067L, 2291114854896829159L, -3237903676947602091L, -4640889180432530876L, -6956705385196247004L, 5903053950100844597L, 6666107027411611898L, -218426187369631167L, 3626425922614869470L, -8325814959521189771L, -5063052553617656857L, 9148094160140652064L, 1284939680052264319L, 7307368198934274627L, 5611679697977124792L, -7577707393933148579L, 4819485793530191663L, 7866624006794876513L, 4794093907474700625L, 6849775302623042486L, 4177248038373896072L, -7798627118210467701L, 7195685255425235832L, -1434736733280752266L, 6004979459829542343L, 575228772519342402L, 5806056339682094430L, 8920438500019044156L, 1872523786854905556L, 7168173152291242201L, -9058528327592164873L, 8767779863385330152L, 1489771135892281206L, -1061241206578699883L, -2684379813869300996L, 2649182342564336630L, -4940966502553021718L, 928423270205194457L, -6585158539226940220L, -1613020756858095303L, 2875176145464482879L, -8847901732119490575L, 6103491276194240627L, 8264435384771931435L, -1255011998991573177L, -7312248682904753503L, 8118948727165493749L, -452438870359771710L, -8668335600576165967L, -6672393216155760456L, -5887731630549795598L, 1810658488341658557L, -8665204105580500247L, 658149708018956377L, -69816450156784432L, -8221078497326742194L, -7199510714699703159L, -5480269155866560275L, 4111328737826509899L, 6628917895947053289L, 2166287019647928708L, -7317033582308389709L, 5728850993485642500L, 7135057069693417668L, 2409960466139986440L, 6600979542443030540L, 5794634036844991298L, 1765885809474863574L, 7278670237115156036L, -2318345334258142041L, -1183745501610368782L, 8877430296282562796L, -5044746123895283133L, 407550088776850295L, -5365866959392798091L, 5365205568318698487L, -3511034280684146806L, -776761410179450844L, 4357691132969283455L, -1304134592068362083L, 8763584794241613617L, -8767545796439405940L, -7505469452821431437L, -6753601202686884558L, 306186389089741728L, -7922319286853618274L, 8136607301146677452L, 8332101422058904765L, 6215931344642484877L, -1176482456577273983L, -4962589000476002385L, 5040091220514117480L, -7849913836115364766L, -43044781523771743L, -5881067973083878800L, -2509529976529168132L, 9145986266726084057L, 2521545561146285852L, -3956411269506295511L, -9184011107927260315L, -2394674665211165194L, 2012514900658959106L, 4851386166840481282L, -6154561019552412806L, -6307235393847693738L, 7319524202191393198L, -2390612934246005514L, 2445601317840807269L, -5470303936463679940L, -7946502699748727984L, 1211454228928495690L, 2931510483461322717L, -4193944676823227306L, 6217490319246239553L, 3253094721785420467L, -7222186592991335468L, -1211743989268045124L, -5827584294354409384L, 5189293263797206570L, -5840131557960057277L, 1850950425290819967L, 5933835573330569280L, -797006402233243920L, 1240625309976189683L, -4835227570594987755L, -7087500065266820785L, 463713201815588887L, 5603848033623546396L, 5837679654670194627L, -4577276249006689100L, -5445157863262884228L, -5511954857782272889L, 2422944928445377056L, 3310549754053175887L, 8519766042450553085L, -606925578055940448L, -2942946220820427471L, -2435486243585145781L, 862037678550916899L, 3197637623672940211L, 5210919022407409764L, -3475573908164538853L, -5738531550834291303L, -7286398923439835928L, -6558283579219683126L, -1777488582077034890L, 7618258446600650238L, -453254132140704618L, -258250171718674949L, -7176401658345012201L, -8157851634567385392L, 7423022476929853822L, -4231143402258348978L, 8710936142583354014L, -100692273235294726L, 629718674134230549L, -7848113977168848178L, -7780501039097782411L, -2369562330250108912L, 4303848835390748061L, -3262948163554511041L, -602825012910263304L, -2885415085016290431L, -2784376253081124953L, 3706272247737428199L, -6395030266941625231L, -6704140522967532107L, 5704473791139820979L, -8659436106485368743L, 1637612482787097121L, 8908762506463270222L, -889891063729036404L, 4157033003383749538L, -238877964596788188L, 1800584982121391508L, 5477894166363593411L, 4674885479076762381L, -8286718691916758335L, 7550910419722901151L, 8799727354050345442L, -7125432498641740945L, 4039979115090434978L, 3605513501649795505L, 3876110682321388426L, -6265874557923512399L, 8620494007958685373L, 5854220346205463345L, 4855373848161890066L, -2791760472357952421L, 5949110547793674363L, 5957016279979211145L, -7125263955721355405L, 8228060533160592200L, 2094843038752308887L, 8801329274201873314L, 297395810205168342L, 6489982145962516640L, 925952168551929496L, 6268205602454985292L, 2903841526205938350L, 359914117944187339L, 8371662176944962179L, -7307597380444705476L, -8639167831183607326L, 5795683315677088036L, -5757784274115990919L, 1070089889651807102L, 6778454470502372484L, -686688449954468754L, 1983224895012736197L, -2685835992369688543L, 942692161281275413L, -6312457544560218087L, -7799067531746373637L, -7356718043541534927L, 5245566602671237210L, 9195060651485531055L, 6368791473535302177L, 3229483537647869491L, -3214461869429917290L, 928484295759785709L, 1909608352012281665L, -8034650149685246498L, 5773445318897257735L, 3990834569972524777L, -7675348306896289970L, 4209783265310087306L, -3128590709331025083L, 616435239304311520L, -485352023391264328L, 7798983577523272147L, 3913469721920333102L, -3022076089717407198L, 6239239264182308800L, 1654244791516730287L, -1217848141703766125L, 6221161860315361832L, -1390141990708018827L, -4987831551100114613L, -5529078456224335278L, 7337288846716161725L, -5424555790927851038L, -5466800325109811545L, 510457344639386445L, 8796640079689568245L, -4881735209222593326L, 6465331256500611624L, -7415446863621302972L, 8017026739316632057L, 3627975979343775636L, -3394528423913180349L, 6222903725779446311L, 3527832623857636372L, -2849693101024154289L, 8924250025456295612L, -4045937359548092780L, -7747633557851937220L, -3978586660626014369L, 4223238849618215370L, -2764893807176054556L, 1140009269240963018L, -5480222307947335495L, -5751042123502621052L, 3881319844097050799L, -1588072837735502258L, -1442565630059000999L, -7902221177050684800L, -5067872407110470413L, 7580967567056532817L, -4166857726643058241L, -3655428046510026134L, -4906602186354729269L, -2556870867600940496L, -5005447323036875848L, -6648276097457692213L, -1587952015247572959L, 704784010218719535L, -8849761751120126775L, -9149066151885549738L, 687173692492309888L, 2573542046251205823L, -4381758060701354339L, 5122261027125484554L, -6280299527312203635L, 392580029432520891L, -5369083948807480889L, -1668041885421938881L, 3451078315256158032L, 1238907336018749328L, 9205113463181886956L, 1667962162104261376L, -7615990091925507577L, 4479827962372740717L, -4723074364987629396L, -550798907951659849L, 5275192813757817777L, 2148246364622112874L, 2290795724393258885L, -253162723436299526L, 1776293542351822525L, -3689732299588779379L, 4313244667902787366L, -6165228101000850014L, -1635869182558457729L, -5214973253231643794L, -3108706094173697875L, 3321611548688927336L, 3305807524324674332L, -5061732229000748930L, 7248312053715383136L, -7754480333218511484L, -2611856101870623399L, -3282213444060272849L, 9112428691881135949L, 7848957776938116907L, -7494927886966539228L, 8896660382367628050L, -8842837798196294764L, 8762207035762213579L, -3459299730036712668L, -9036992843571423785L, -7855717824450087951L, 7197363620976276483L, -4145362416552097252L, 6373588016705149671L, 685071415365890925L, -6961025044515806144L, -6921029952340425425L, -1983292083700476020L, -1733165894704959795L, 6251124536988276734L, 6144308296388004591L, 8880818733894805775L, 1303007271453773655L, 9174156641096830119L, 8824404812019774483L, 4420129794615782201L, -8495187234923475788L, 8883975763174874978L, -7709859765033275901L, 5595889224692918441L, 4306406647446967767L, 6704191827946442961L, 9195534799547011879L, -2721803534724933711L, -2531729836700005339L, 3928039610514994951L, -3573548994530823287L, -6084204670034616524L, 4869881251581666789L, -5460400459106163223L, 1215083005313393810L, -2611389914965073217L, -7260687268226227326L, -5297507950653649788L, -4625529213342012336L, -6264054769160028483L, 2305696533800337221L, -6047495272998113561L, -5834172998942348995L, 1949121388445288260L, -5379009770048591566L, -4360815174901894470L, -4347701924302501399L, -884756771763845121L, -6934285729554595366L, 7437568954088789707L, 7915171836405846582L, -6694092778555253967L, 520574178807700830L, -8462680832637173339L, -2192588427498456587L, 8412807604418121470L, 5609875541891257226L, -7122885458123533268L, 8376971840073549054L, 1383314287233606303L, -2972521237957530560L, 5204145074798490767L, 2167677454434536938L, -8105325240265828673L, 8271005071015654673L, -2909286158269631396L, -7715852896319476306L, -6935247590537980960L, -2420506449658262810L, -6607626754690151490L, -7125392814103915483L, 5895970210948560438L, 3447475526873961356L, 7334775646005305872L, -2492284066326686611L, 6939292427400212706L, 8334626163711782046L, 1912937584935571784L, -6141772829141909856L, 8524679326357320614L, 2204997376562282123L, 3197166419597805379L, 4220875528993937793L, 2803169229572255230L, 5085503808422584221L, -4001944857184464756L, 4570145336765972565L, 9186432380899140933L, -7207128850928187954L, -8573836118959825828L, -8077052725099091274L, -6872901447497050402L, -396816797984991405L, -2974960788477327719L, -2311998167136774173L, -5297324270288368904L, -3882604781526113051L, 2088698177441502777L, -3346872395976619286L, 5679318949880730421L, -1955705304021469742L, 1684901764271550206L, 6019498834983443029L, 8308552077872645018L, 2774412133178445207L, 2993471197969887147L, 8756104692490586069L, 7404378077533100169L, -7054918957238328127L, -1318335436663551995L, 5816122712455824169L, 5531291136777113635L, 7400684525794093602L, 2421696223438995901L, 2746718911238191773L, 2297623779240041360L, -2931757618997826117L, -5091566080359364152L, 2151598180055853022L, -3513011632246703702L, -795500665323736509L, 4086544267540179726L, 3960368502933186560L, -1498129122236047154L, -7184131849074362877L, -5833233003560719734L, 2706199935239343179L, -8392284860076226467L, -805786339615115179L, -3155757358848065085L, -1830170615095512051L, 2626432152093131908L, -4421998591500243275L, -6102548667584133652L, 7167044992416702836L, -6512755018830767576L, 1255659969011027721L, 3240842176865726111L, 795178308456769763L, -6057660688470347791L, 6408553047871587981L, -4114748024493078816L, 3362936192376505047L, 1486633608756523830L, 8937438391818961808L, -2933041310131459385L, -9204136428534629549L, -1447368335367659065L, 225631029947824688L, 5294122026845313316L, -6779834932302576312L, 6576914768872977647L, -5432401932016084426L, -3149974553771293647L, 1344590668019013826L, 8870296219354404L, 1763076921063072981L, -6735912242669201170L, -7404447858617298160L, -5523242177286330794L, 2679459049130362043L, -3297604595876809216L, 2006921612949215342L, 2441159149980359103L, 4254066403785111886L, -8280748781830503314L, -478226388169132300L, 4067155115498534723L, -3862070249752561130L, 7262306400971602773L, 2599246507224983677L, 1183331494191622178L, 9203696637336472112L, 8684305384778066392L, 452576500022594089L, 7158260433795827572L, 5749101480176103715L, 2141838636388669305L, -5127046408239983365L, -6707005227519968031L, -2742143461777474807L, -1158177344673395093L, 3345333136360207999L, -6221075131749871973L, -5310895318150965567L, 8127707564878445808L, -7426305334632631762L, -4646510815755199649L, -7727291720446440205L, 4467639418469323241L, -5105491203086766093L, 7043015398453076736L, -4643966542147613368L, 2597087673064131360L, -250124276606665209L, -1224189853575564238L, -6843171236372059126L, -9073093575002869048L, -3198758860386093361L, 2826050093225892884L, 7047939442312345917L, 1975862676241125979L, 8471065344236531211L, -7665310745516932263L, -5736484889461131955L, 6983092299355911633L, 8891398163252015007L, -213906536485350214L, -8317869669453183656L, 1184291664448112016L, 8752186474456668498L, -6562869240740929461L, 8304258407043758711L, -5415306440973393561L, -7052086191139373095L, -7100384126557577363L, -3239204636105726481L, 6743071165850287963L, 1895531807983368793L, 8070015023023620019L, -2451832056240883254L, 7264555371116116147L, 638838107884199779L, 612060626599877907L, -2078162528421891077L, 2028126038944990910L, 8217932366665821866L, -5731027174718830117L, 4917760284400488853L, 4689038209317479950L, -2876688578317531702L, 7353589116749496814L, 6461588461223219363L, -1709513839274943977L, -7802992490642642440L, -4557372729334641201L, -3822959266735082868L, 6280119077769544053L, 5795026310427216669L, -2865201508933622433L, 5344020438314994897L, -1356161753273905001L, -5376351730844657950L, 2499216570383001617L, 5973851566933180981L, -7283548499500808528L, -7759862821659811914L, 7802414647854227001L, 7696730671131205892L, -6507191444373290905L, 8954801150602803298L, 5805966293032425995L, -7838261593662321029L, 4997389530575201269L, 7710978612650642680L, 7716832357345836839L, -3323431321145327255L, -2446429154351403408L, 5766400084981923062L, -7200857806063814540L, 8713884558928322285L, 7910921931260759656L, -1254265329846611475L, 3651028258442904531L, 4208705969817343911L, 3568641929344250749L, 7493701010274154640L, 2245920858524015772L, -5287726615758083227L, -6156110632223716108L, -847676012271350765L, -339391230761074478L, 3841784002685309084L, 3972025232192455038L, 7780701379940603769L, -3673543119483549832L, -2078634282757881654L, -6948684187833482934L, 331717439817162336L, -236792732567011685L, 639100052003347099L, -8099574507787307615L, -5353646232683726234L, 2526013881820679475L, 4894708394808468861L, 4217798054095379555L, 2415982786774940751L, 2008219703699744969L, 6034935405124924712L, -2068809033829413525L, -2976794435908412034L, 6813989660423069229L, 3171782229498906237L, -5689255409585681882L, 4587441767303016857L, 1011542511767058351L, 1218420902424652599L, -6994674436138682061L, -3114493420313727393L, -9127831760372958176L, -7947387725428979194L, -1404709700660885128L, 1805505087651779950L, -5363013951754450589L, -8519877247653478975L, -6051660936535374862L, -5432657379715846560L, -354324339393897847L, 4496402702769466389L, 4275128525646469625L, -1727796887562541994L, 2644524053331857687L, -1781398766969753407L, 756689505943647349L, 6332958748006341455L, 5397518675852254155L, 3282372277507744968L, -3321886456795945333L, -8488570490783378132L, 550475751710050266L, -8911359377770791788L, -7418949222395686301L, 1895999114042080393L, -650773357961068032L, 3512907883609256988L, -8275867100986890362L, 5100888107877796098L, -3680555303400859359L, 5664728055166256274L, 1867780161745570575L, 5069314540135811628L, -7620386572563399119L, 8428576418859462269L, 6489498281288268568L, 248384571951887537L, -4037852901788685727L, 3830179243734057519L, -7470369288476554443L, -6071470395341666208L, -3529173984278120528L, 5317296011783481118L, 8812437177215009958L, -2744615621445586530L, 1418237564682130775L, 8287918193617750527L, 5641726496814939044L, -47443777466463686L, 6176181444192939950L, -5160524448685921952L, -3836896475970613836L, -2668126031979123873L, -5332828906549230440L, 3534397173597697283L, -1693429024984254962L, 2378655170733740360L, -552643018769440755L, 551298419243755034L, -4269103759267730770L, -435572429638872008L, 1942137629605578202L, -741773765110731084L, -7626055490284413820L, 319261663834750185L, -1126723894144361908L, -7617977520976348028L, -7192578181343322179L, 5921710089078452638L, 1692791583615940497L, 3154220012138640370L, 2462272376968205830L, 5215882904155809664L, 9063345109742779520L, -8434249029387572864L, 2282028593076952567L, -1956459363404282278L, -7088568204036607476L, 2648366387851958704L, 2535530668932196013L, -3060551081441224714L, 6797681746413993003L, 9131737009282615627L, 744965241806492274L, -2912572593751847674L, -7040231872174702793L, 1724859165393741376L, 2131804225590070214L, -7796891254993561507L, 7348272751505534329L, -3028133809084889899L, -4416447665223034257L, 6426639016335384064L, -3589502756575571236L, 8982836549816060296L, 2847738978322528776L, -4171543124651995508L, 1517491100508351526L, -6959678130640022028L, 7252270709068430025L, 1454069630547688509L, 879136823698237927L, 764541931096396549L, -1818291546970408658L, 8210570252116953863L, -1027731306262305510L, -1789924905178677132L, -7567181820563274204L, -9105903926093857371L, 6892625624787444041L, 6239858431661771035L, -7962612811332817823L, -3310835631931791777L, 3591372000141165328L, -1052235342745599600L, -6521666110210903136L, 2231224496660291273L, 8127998803539291684L, -2154291592623801641L, 16488107566197090L, 2060923303336906913L, -3516953014032317815L, -3394515125949629582L, 8630622898638529667L, 7467898009369859339L, -516182592762444535L};

    private static long getActiveColorKey(FEN fEN) {
        if (fEN.getActiveColorChar() == 'w') {
            return randoms[780];
        }
        return 0L;
    }

    private static long getCastlingKey(FEN object) {
        char[] arrc;
        object = object.getCastlingString();
        char[] arrc2 = arrc = new char[8];
        arrc2[0] = 72;
        arrc2[1] = 65;
        arrc2[2] = 104;
        arrc2[3] = 97;
        arrc2[4] = 75;
        arrc2[5] = 81;
        arrc2[6] = 107;
        arrc2[7] = 113;
        long l = 0L;
        for (int i = 0; i < arrc.length; ++i) {
            long l2 = l;
            if (object.indexOf(arrc[i]) > -1) {
                l2 = l ^ randoms[768 + i % 4];
            }
            l = l2;
        }
        return l;
    }

    private static long getEnpassantKey(FEN serializable) {
        long l;
        serializable = new Position((FEN)serializable);
        Square square = serializable.getEnPassantSquare();
        long l2 = l = 0L;
        if (square != null) {
            l2 = l;
            if (square.isValid()) {
                l2 = l;
                if (serializable.isEnPassantReallyPossible()) {
                    l2 = 0L ^ randoms[772 + square.getColumn()];
                }
            }
        }
        return l2;
    }

    public static long getKeyFromFEN(FEN fEN) {
        return PolyglotBinBookHelper.getPiecesKey(fEN) ^ PolyglotBinBookHelper.getCastlingKey(fEN) ^ PolyglotBinBookHelper.getEnpassantKey(fEN) ^ PolyglotBinBookHelper.getActiveColorKey(fEN);
    }

    private static long getPiecesKey(FEN object) {
        object = new Position((FEN)object).getAllPieces().iterator();
        long l = 0L;
        while (object.hasNext()) {
            PieceInformation pieceInformation = (PieceInformation)object.next();
            int n = PolyglotBinBookHelper.pieceCharToPolyglotInt(pieceInformation.getPiece().getFENChar());
            int n2 = pieceInformation.getSquare().getRow();
            int n3 = pieceInformation.getSquare().getColumn();
            l ^= randoms[64 * n + 8 * n2 + n3];
        }
        return l;
    }

    private static int pieceCharToPolyglotInt(char c) {
        return "pPnNbBrRqQkK".indexOf(c);
    }
}
